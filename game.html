<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Vuole Essere Il Doge? - Gioco</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="game-body">
    <div class="game-container">
        <!-- Barra superiore con informazioni -->
        <div class="top-bar">
            <div class="player-info">
                <span id="playerNameDisplay">Giocatore</span>
            </div>
            <div class="current-prize">
                <span>Premio attuale: </span>
                <span id="currentPrize" class="prize-amount">â‚¬0</span>
            </div>
            <div class="timer-container">
                <span>Tempo: </span>
                <span id="timer">30</span>
            </div>
        </div>

        <!-- Area domanda -->
        <div class="question-area">
            <div class="question-number">
                Domanda <span id="questionNumber">1</span> di 15
            </div>
            <div class="question-text" id="questionText">
                La domanda apparirÃ  qui...
            </div>
        </div>

        <!-- Area risposte -->
        <div class="answers-container">
            <div class="answer-row">
                <button class="answer-btn" data-answer="A" onclick="selectAnswer('A')">
                    <span class="answer-letter">A:</span>
                    <span class="answer-text" id="answerA">Risposta A</span>
                </button>
                <button class="answer-btn" data-answer="B" onclick="selectAnswer('B')">
                    <span class="answer-letter">B:</span>
                    <span class="answer-text" id="answerB">Risposta B</span>
                </button>
            </div>
            <div class="answer-row">
                <button class="answer-btn" data-answer="C" onclick="selectAnswer('C')">
                    <span class="answer-letter">C:</span>
                    <span class="answer-text" id="answerC">Risposta C</span>
                </button>
                <button class="answer-btn" data-answer="D" onclick="selectAnswer('D')">
                    <span class="answer-letter">D:</span>
                    <span class="answer-text" id="answerD">Risposta D</span>
                </button>
            </div>
        </div>

        <!-- Aiuti -->
        <div class="lifelines-container">
            <button class="lifeline-btn" id="fiftyFifty" onclick="useFiftyFifty()">
                <span class="lifeline-icon">50:50</span>
                <span class="lifeline-name">50/50</span>
            </button>
            <button class="lifeline-btn" id="askAudience" onclick="askAudience()">
                <span class="lifeline-icon">ðŸ‘¥</span>
                <span class="lifeline-name">Aiuto del Pubblico</span>
            </button>
            <button class="lifeline-btn" id="phoneCall" onclick="phoneCall()">
                <span class="lifeline-icon">ðŸ“ž</span>
                <span class="lifeline-name">Telefonata</span>
            </button>
        </div>

        <!-- Scala premi -->
        <div class="prize-ladder">
            <h3>Scala Premi</h3>
            <div class="prizes-list" id="prizesList">
                <!-- I premi verranno generati dinamicamente -->
            </div>
        </div>

        <!-- Pulsante ritiro -->
        <div class="game-actions">
            <button class="action-btn retire-btn" onclick="retireMoney()">
                ðŸ’° Ritira il Premio
            </button>
            <button class="action-btn quit-btn" onclick="quitGame()">
                ðŸšª Abbandona
            </button>
        </div>
    </div>

    <!-- Modal Aiuto Pubblico -->
    <div id="audienceModal" class="modal">
        <div class="modal-content">
            <h2>ðŸ“Š Aiuto del Pubblico</h2>
            <div id="audienceChart" class="audience-chart">
                <!-- Grafico percentuali pubblico -->
            </div>
            <button class="menu-btn" onclick="closeAudienceModal()">Chiudi</button>
        </div>
    </div>

    <!-- Modal Telefonata -->
    <div id="phoneModal" class="modal">
        <div class="modal-content">
            <h2>ðŸ“ž Telefonata all'Amico</h2>
            <div id="phoneAdvice" class="phone-advice">
                <!-- Consiglio dell'amico -->
            </div>
            <button class="menu-btn" onclick="closePhoneModal()">Chiudi</button>
        </div>
    </div>

    <!-- Modal Fine Gioco -->
    <div id="gameOverModal" class="modal">
        <div class="modal-content game-over">
            <h2 id="gameOverTitle">Game Over</h2>
            <div id="gameOverMessage" class="game-over-message"></div>
            <div id="finalPrize" class="final-prize"></div>
            <div class="game-over-actions">
                <button class="menu-btn" onclick="playAgain()">Gioca Ancora</button>
                <button class="menu-btn" onclick="backToMenu()">Menu Principale</button>
            </div>
        </div>
    </div>

    <!-- Pulsante musica flottante -->
    <button id="musicToggle" class="music-toggle-btn" onclick="toggleMusic()" title="Attiva/Disattiva Musica">
        ðŸ”‡
    </button>

    <script src="controllers.js"></script>
    <script>
        // ============================================
        // MUSICA SUSPENSE IN-GAME
        // ============================================
        let audioCtx = null;
        let musicPlaying = false;
        let musicInterval = null;
        let musicGain = null;

        function createMusicContext() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            musicGain = audioCtx.createGain();
            musicGain.gain.value = 0.12;
            musicGain.connect(audioCtx.destination);
        }

        function playNote(freq, startTime, duration, type = 'sine', volume = 0.12) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(volume, startTime + 0.05);
            gain.gain.setValueAtTime(volume, startTime + duration - 0.08);
            gain.gain.linearRampToValueAtTime(0, startTime + duration);
            osc.connect(gain);
            gain.connect(musicGain);
            osc.start(startTime);
            osc.stop(startTime + duration);
        }

        function playGameLoop() {
            if (!audioCtx) createMusicContext();
            const now = audioCtx.currentTime;
            const bpm = 72;
            const beat = 60 / bpm;

            // Pulsazione bassa tesa
            for (let i = 0; i < 16; i++) {
                playNote(110, now + i * beat * 0.5, beat * 0.4, 'triangle', 0.1);
                playNote(55, now + i * beat * 0.5, beat * 0.4, 'sine', 0.06);
            }

            // Arpeggio suspense minore
            const suspenseArp = [
                [220, 0], [261.63, 0.5], [293.66, 1], [261.63, 1.5],
                [220, 2], [261.63, 2.5], [311.13, 3], [293.66, 3.5],
                [220, 4], [261.63, 4.5], [293.66, 5], [261.63, 5.5],
                [207.65, 6], [246.94, 6.5], [293.66, 7], [261.63, 7.5]
            ];
            suspenseArp.forEach(([freq, time]) => {
                playNote(freq, now + time * beat, beat * 0.4, 'sine', 0.06);
            });

            // Tick orologio sottile
            for (let i = 0; i < 16; i++) {
                playNote(1200, now + i * beat * 0.5, 0.02, 'square', 0.015);
            }
        }

        function toggleMusic() {
            const btn = document.getElementById('musicToggle');
            if (musicPlaying) {
                clearInterval(musicInterval);
                if (musicGain) musicGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                musicPlaying = false;
                btn.textContent = 'ðŸ”‡';
                btn.title = 'Attiva Musica';
            } else {
                if (!audioCtx) createMusicContext();
                if (audioCtx.state === 'suspended') audioCtx.resume();
                musicGain.gain.value = 0.12;
                playGameLoop();
                musicInterval = setInterval(playGameLoop, 5600);
                musicPlaying = true;
                btn.textContent = 'ðŸ”Š';
                btn.title = 'Disattiva Musica';
            }
        }

        // Inizializza il gioco quando la pagina Ã¨ caricata
        window.onload = function() {
            initGame();
        };
    </script>

    <style>
        .music-toggle-btn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 2px solid rgba(255, 215, 0, 0.6);
            background: rgba(13, 20, 66, 0.85);
            color: white;
            font-size: 1.6rem;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 215, 0, 0.15);
            transition: all 0.3s ease;
        }
        .music-toggle-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), 0 0 30px rgba(255, 215, 0, 0.3);
            border-color: rgba(255, 215, 0, 0.9);
        }
    </style>
</body>
</html>
